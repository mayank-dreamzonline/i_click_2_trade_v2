## This file is used to test the scenarios
import pandas as pd
#from tabulate import tabulate
import logging
from logging_config import setup_logging
import time   # <--- ADDED: Required for high-resolution timing
from trade import TradeManager
import trade_logger

logger = logging.getLogger(__name__)

setup_logging()

from trade import TradeManager

from breeze_auth import BreezeAuth
trade_logger.init_db()


#auth = BreezeAuth()
#breeze = auth.get_client()   # this is the BreezeConnect object

msg=[ {'stock_name': 'REC LIMITED(FUT-RURELE-30-Sep-2025)Future-Sell', 'stock_code': 'RURELE', 'action_type': 'sell', 'expiry_date': '30-Sep-2025', 'strike_price': '', 'option_type': '', 'stock_description': 'Future', 'recommended_price_and_date': '379-380,2025-08-22 14:44:25', 'recommended_price_from': '379', 'recommended_price_to': '380', 'recommended_date': '2025-08-22 14:44:25', 'target_price': '355', 'sltp_price': '392', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '  ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'EXIDE INDUSTRIES LTD(FUT-EXIIND-30-Sep-2025)Future-Buy', 'stock_code': 'EXIIND', 'action_type': 'buy', 'expiry_date': '30-Sep-2025', 'strike_price': '', 'option_type': '', 'stock_description': 'Future', 'recommended_price_and_date': '398-401,2025-08-22 14:46:06', 'recommended_price_from': '398', 'recommended_price_to': '401', 'recommended_date': '2025-08-22 14:46:06', 'target_price': '420', 'sltp_price': '390', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '  ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'DR REDDYS LABORATORIES LTD(DRREDD)Margin-Buy', 'stock_code': 'DRREDD', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1280-1282,2025-08-22 11:24:13', 'recommended_price_from': '1280', 'recommended_price_to': '1282', 'recommended_date': '2025-08-22 11:24:13', 'target_price': '1295', 'sltp_price': '1274', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '1277', 'recommended_update': 'Exit:2025-08-22 15:07:04  ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'DR REDDYS LABORATORIES LTD(DRREDD)Margin-Buy', 'stock_code': 'DRREDD', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1280-1282,2025-08-22 11:24:13', 'recommended_price_from': '1280', 'recommended_price_to': '1282', 'recommended_date': '2025-08-22 11:24:13', 'target_price': '1295', 'sltp_price': '1274', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '1277', 'recommended_update': 'Exit:2025-08-22 15:07:04  ', 'iclick_status': 'closed', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'OBEROI REALTY LIMITED(FUT-OBEREA-28-Aug-2025)Future-Sell', 'stock_code': 'OBEREA', 'action_type': 'sell', 'expiry_date': '28-Aug-2025', 'strike_price': '', 'option_type': '', 'stock_description': 'Future', 'recommended_price_and_date': '1648-1649,2025-08-22 09:31:50', 'recommended_price_from': '1648', 'recommended_price_to': '1649', 'recommended_date': '2025-08-22 09:31:50', 'target_price': '1625', 'sltp_price': '1660', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '  SLTP:2025-08-22 15:18:28', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'HCL TECHNOLOGIES LIMITED(HCLTEC)Margin-Sell', 'stock_code': 'HCLTEC', 'action_type': 'sell', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1467-1469,2025-08-22 14:37:18', 'recommended_price_from': '1467', 'recommended_price_to': '1469', 'recommended_date': '2025-08-22 14:37:18', 'target_price': '1454', 'sltp_price': '1476', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '1467', 'recommended_update': 'Exit:2025-08-22 15:20:44  ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'HCL TECHNOLOGIES LIMITED(HCLTEC)Margin-Sell', 'stock_code': 'HCLTEC', 'action_type': 'sell', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1467-1469,2025-08-22 14:37:18', 'recommended_price_from': '1467', 'recommended_price_to': '1469', 'recommended_date': '2025-08-22 14:37:18', 'target_price': '1454', 'sltp_price': '1476', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '1467', 'recommended_update': 'Exit:2025-08-22 15:20:44  ', 'iclick_status': 'closed', 'subscription_type': 'iclick_2_gain  '},
 {'stock_name': 'SIEMENS LTD(FUT-SIEMEN-28-Aug-2025)Future-Buy', 'stock_code': 'SIEMEN', 'action_type': 'buy', 'expiry_date': '28-Aug-2025', 'strike_price': '', 'option_type': '', 'stock_description': 'Future', 'recommended_price_and_date': '3177-3181,2025-08-25 10:26:01', 'recommended_price_from': '3177', 'recommended_price_to': '3181', 'recommended_date': '2025-08-25 10:26:01', 'target_price': '3220', 'sltp_price': '3155', 'part_profit_percentage': '0,0', 'profit_price': '3202', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 11:07:18    ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'DIXON TECHNOLOGIES INDIA LTD(OPT-DIXTEC-28-Aug-2025-17250-CE)Options-Buy', 'stock_code': 'DIXTEC', 'action_type': 'buy', 'expiry_date': '28-Aug-2025', 'strike_price': '17250', 'option_type': 'call', 'stock_description': 'Options', 'recommended_price_and_date': '210-214,2025-08-25 11:15:39', 'recommended_price_from': '210', 'recommended_price_to': '214', 'recommended_date': '2025-08-25 11:15:39', 'target_price': '320', 'sltp_price': '150', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '     ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'DIXON TECHNOLOGIES INDIA LTD(OPT-DIXTEC-28-Aug-2025-17250-CE)Options-Buy', 'stock_code': 'DIXTEC', 'action_type': 'buy', 'expiry_date': '28-Aug-2025', 'strike_price': '17250', 'option_type': 'call', 'stock_description': 'Options', 'recommended_price_and_date': '210-214,2025-08-25 11:15:39', 'recommended_price_from': '210', 'recommended_price_to': '214', 'recommended_date': '2025-08-25 11:15:39', 'target_price': '320', 'sltp_price': '150', 'part_profit_percentage': '0,0', 'profit_price': '233', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 11:35:52    ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'INFOSYS LTD(INFTEC)Margin-Buy', 'stock_code': 'INFTEC', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1527-1529,2025-08-25 10:40:23', 'recommended_price_from': '1527', 'recommended_price_to': '1529', 'recommended_date': '2025-08-25 10:40:23', 'target_price': '1545', 'sltp_price': '1518', 'part_profit_percentage': '0,0', 'profit_price': '1537', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 12:08:12    ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'INFOSYS LTD(INFTEC)Margin-Buy', 'stock_code': 'INFTEC', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1527-1529,2025-08-25 10:40:23', 'recommended_price_from': '1527', 'recommended_price_to': '1529', 'recommended_date': '2025-08-25 10:40:23', 'target_price': '1545', 'sltp_price': '1518', 'part_profit_percentage': '0,0', 'profit_price': '1537', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 12:08:12    ', 'iclick_status': 'closed', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'CHALET HOTELS LIMITED(CHAHOT)Gladiator Stocks-Buy', 'stock_code': 'CHAHOT', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Gladiator Stocks', 'recommended_price_and_date': '960-985,2025-08-20 10:06:05', 'recommended_price_from': '960', 'recommended_price_to': '985', 'recommended_date': '2025-08-20 10:06:05', 'target_price': '1115', 'sltp_price': '985', 'part_profit_percentage': '1048,50', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '  Book Partial Profit:2025-08-25 13:39:21   ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'HINDALCO INDUSTRIES LIMITED(HINDAL)Margin-Buy', 'stock_code': 'HINDAL', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '714-715,2025-08-25 09:30:31', 'recommended_price_from': '714', 'recommended_price_to': '715', 'recommended_date': '2025-08-25 09:30:31', 'target_price': '723', 'sltp_price': '709', 'part_profit_percentage': '0,0', 'profit_price': '720', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 14:32:06    ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'HINDALCO INDUSTRIES LIMITED(HINDAL)Margin-Buy', 'stock_code': 'HINDAL', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '714-715,2025-08-25 09:30:31', 'recommended_price_from': '714', 'recommended_price_to': '715', 'recommended_date': '2025-08-25 09:30:31', 'target_price': '723', 'sltp_price': '709', 'part_profit_percentage': '0,0', 'profit_price': '720', 'exit_price': '0', 'recommended_update': ' Book Full Profit:2025-08-25 14:32:06    ', 'iclick_status': 'closed', 'subscription_type': 'iclick_2_gain                 '},
 {'stock_name': 'ZYDUS LIFESCIENCES LIMITED(CADHEA)Margin-Buy', 'stock_code': 'CADHEA', 'action_type': 'buy', 'expiry_date': '', 'strike_price': '', 'option_type': '', 'stock_description': 'Margin', 'recommended_price_and_date': '1024-1025,2025-08-25 14:43:22', 'recommended_price_from': '1024', 'recommended_price_to': '1025', 'recommended_date': '2025-08-25 14:43:22', 'target_price': '1038', 'sltp_price': '1018', 'part_profit_percentage': '0,0', 'profit_price': '0', 'exit_price': '0', 'recommended_update': '     ', 'iclick_status': 'open', 'subscription_type': 'iclick_2_gain                 '}
]

for i in msg:
    try:
        trade_logger.log_recommendation(i)
    except Exception as e:
        logger.error(f"Failed to log recommendation: {e}")